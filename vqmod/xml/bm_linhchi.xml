<modification>
	<id>for site linhchinonglam.com</id>
	<version>2.0.x</version>
	<vqmver>1.0</vqmver>
	<author>Bommer Luu</author>
	<file name="catalog/controller/common/header.php">
		<operation>
			<search position="after"><![CDATA[
				$data['text_all'] = $this->language->get('text_all');
			]]></search>
			<add><![CDATA[
				$data['text_register_affiliate'] = $this->language->get('text_register_affiliate');
				$data['text_login_affiliate'] = $this->language->get('text_login_affiliate');
				$data['text_register_user'] = $this->language->get('text_register_user');
				$data['text_login_user'] = $this->language->get('text_login_user');
				$data['text_product'] = $this->language->get('text_product');
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[
				$data['login'] = $this->url->link('account/login', '', 'SSL');
			]]></search>
			<add><![CDATA[
				$data['register_affiliate'] = $this->url->link('affiliate/register', '', 'SSL');
				$data['login_affiliate'] = $this->url->link('affiliate/login', '', 'SSL');
				$data['contact'] = $this->url->link('information/contact', '', '');
				$data['account'] = $this->url->link('account/account', '', 'SSL');
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
				$data['text_logged'] = sprintf($this->language->get('text_logged'), $this->url->link('account/account', '', 'SSL'), $this->customer->getFirstName(), $this->url->link('account/logout', '', 'SSL'));
			]]></search>
			<add><![CDATA[
				if ( $this->affiliate->isLogged() )
					$data['text_logged'] = sprintf($this->affiliate->getFirstName() . ' ' . $this->affiliate->getLastname(), $this->url->link('affiliate/account', '', 'SSL'), $this->affiliate->getFirstName(), $this->url->link('account/logout', '', 'SSL'));
				else
					$data['text_logged'] = sprintf($this->customer->getFirstName() . ' ' . $this->customer->getLastname(), $this->url->link('account/account', '', 'SSL'), $this->customer->getFirstName(), $this->url->link('account/logout', '', 'SSL'));
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
				$data['logged'] = $this->customer->isLogged();
			]]></search>
			<add><![CDATA[
				$data['logged'] = $this->customer->isLogged() || $this->affiliate->isLogged();
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[
				if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') . '/template/common/header.tpl')) {
			]]></search>
			<add><![CDATA[
				// check affiliate
				if ( isset($this->session->data['tracking']) || $this->affiliate->isLogged() ) {
					if ( !$code = $this->affiliate->getCode() ) {
						$code = $this->session->data['tracking'];
					}
					$this->load->model('affiliate/affiliate');
					if ( $affiliate = $this->model_affiliate_affiliate->getAffiliateByCode($code) ) {
						$data['href_home'] = $this->url->link('common/home', 'tracking=0', 'SSL');
					}
				}
			]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[
				$data['logout'] = $this->url->link('account/logout', '', 'SSL');
			]]></search>
			<add><![CDATA[
				if ( !$this->affiliate->isLogged() )
					$data['logout'] = $this->url->link('account/logout', '', 'SSL');
				else
					$data['logout'] = $this->url->link('affiliate/logout', '', 'SSL');
			]]></add>
		</operation>
	</file>
	<file name="catalog/language/english/common/header.php">
		<operation>
			<search position="after"><![CDATA[
				$_['text_all']           = 'See All';
			]]></search>
			<add><![CDATA[
				$_['text_product']       = 'products';
				$_['text_register_affiliate'] = 'Register as an affiliate';
				$_['text_login_affiliate'] = 'Login as an affiliate';
				$_['text_register_user'] = 'Register as a buyer';
				$_['text_loginser'] = 'Login as a buyer';
			]]></add>
		</operation>
	</file>
	<file name="catalog/language/vietnamese/common/header.php">
		<operation>
			<search position="after"><![CDATA[
				$_['text_all']           = 'Xem tất cả';
			]]></search>
			<add><![CDATA[
				$_['text_product']       = 'Sản phẩm';
				$_['text_register_affiliate'] = 'Đăng ký đại lý';
				$_['text_login_affiliate'] = 'Đăng nhập đại lý';
				$_['text_register_user'] = 'Đăng ký người mua';
				$_['text_login_user'] = 'Đăng nhập người mua';
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/product/product.php">
		<operation>
			<search position="after"><![CDATA[
				$data['text_loading'] = $this->language->get('text_loading');
			]]></search>
			<add><![CDATA[
				$data['text_price'] = $this->language->get('text_price');
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[
				$data['tab_description'] = $this->language->get('tab_description');
			]]></search>
			<add><![CDATA[
				$data['tab_product_intro'] = $this->language->get('tab_product_intro');
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[
				$data['points'] = $product_info['points'];
			]]></search>
			<add><![CDATA[
				$data['meta_description'] = $product_info['meta_description'];
			]]></add>
		</operation>
	</file>
	<file name="catalog/language/english/product/product.php">
		<operation>
			<search position="before"><![CDATA[
				$_['tab_description']                         = 'Description';
			]]></search>
			<add><![CDATA[
				$_['tab_product_intro']                       = 'Product introduction';
			]]></add>
		</operation>
	</file>
	<file name="catalog/language/vietnamese/product/product.php">
		<operation>
			<search position="before"><![CDATA[
				$_['tab_description']   = 'Mô tả';
			]]></search>
			<add><![CDATA[
				$_['tab_product_intro']   = 'Giới thiệu sản phẩm';
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/common/footer.php">
		<operation>
			<search position="before"><![CDATA[
				if (file_exists(DIR_TEMPLATE . $this->config->get('config_template') . '/template/common/footer.tpl')) {
			]]></search>
			<add><![CDATA[
				// check affiliate
				if ( isset($this->session->data['tracking']) || $this->affiliate->isLogged() ) {
					if ( !$code = $this->affiliate->getCode() ) {
						$code = $this->session->data['tracking'];
					}
					$this->load->model('affiliate/affiliate');
					if ( $affiliate = $this->model_affiliate_affiliate->getAffiliateByCode($code) ) {
						$data['phone'] = $affiliate['telephone'];
						$data['address'] = $affiliate['address_1'];
						if (!empty($affiliate['address_2'])) {
							$data['address'] .= '<br>' . $affiliate['address_2'];
						}
						$data['email'] = $affiliate['email'];
					} else {
						$data['phone'] = $this->config->get('config_telephone');
						$data['address'] = $this->config->get('config_address');
						$data['email'] = $this->config->get('config_email');
					}
				} else {
					$data['phone'] = $this->config->get('config_telephone');
					$data['address'] = $this->config->get('config_address');
					$data['email'] = $this->config->get('config_email');
				}
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/common/home.php">
		<operation>
			<search position="before"><![CDATA[
				$data['column_left'] = $this->load->controller('common/column_left');
			]]></search>
			<add><![CDATA[
				$data['product_catalog'] = $this->url->link('product/categories', '', 'SSL');
				
				// check affiliate
				if ( isset($this->session->data['tracking']) || $this->affiliate->isLogged() ) {
					if ( !$code = $this->affiliate->getCode() ) {
						$code = $this->session->data['tracking'];
					}
					$this->load->model('affiliate/affiliate');
					if ( $affiliate = $this->model_affiliate_affiliate->getAffiliateByCode($code) ) {
						$data['phone'] = $affiliate['telephone'];
					} else {
						$data['phone'] = $this->config->get('config_telephone');
					}
				} else {
					$data['phone'] = $this->config->get('config_telephone');
				}
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[
				$data['column_left'] = $this->load->controller('common/column_left');
			]]></search>
			<add><![CDATA[
				$data['home_url'] = HTTP_SERVER;
				
				// Column 1
				$data['col_1_html'] = html_entity_decode($this->config->get('introduce_col_1_html'));
				$data['col_1_title'] = $this->config->get('introduce_col_1_title');
				$data['col_1_description'] = $this->config->get('introduce_col_1_description');
				$data['col_1_link'] = $this->config->get('introduce_col_1_link');
				
				// Column 2
				$data['col_2_html'] = html_entity_decode($this->config->get('introduce_col_2_html'));
				$data['col_2_title'] = $this->config->get('introduce_col_2_title');
				$data['col_2_description'] = $this->config->get('introduce_col_2_description');
				$data['col_2_link'] = $this->config->get('introduce_col_2_link');

				// Column 3
				$data['col_3_html'] = html_entity_decode($this->config->get('introduce_col_3_html'));
				$data['col_3_link'] = $this->config->get('introduce_col_3_link');

				// 4 Last news
				$this->load->model('news/news');
				$results = $this->model_news_news->getNewss(array(
					'sort' => 'nd.date_added',
					'order' => 'DESC',
					'start' => 0,
					'limit' => 4
				));

				$data['newses'] = array();
				foreach ($results as $news) {
					$data['newses'][] = array(
						'title' => $news['title'],
						'href' => $this->url->link('news/news', 'news_id=' . $news['news_id'], 'SSL')
					);
				}
			]]></add>
		</operation>
	</file>
	<file name="admin/language/english/catalog/product.php">
		<operation>
			<search position="replace"><![CDATA[
				$_['entry_meta_description'] = 'Meta Tag Description';
			]]></search>
			<add><![CDATA[
				$_['entry_meta_description'] = 'Product introduce';
			]]></add>
		</operation>
	</file>
	<file name="admin/language/vietnamese/catalog/product.php">
		<operation>
			<search position="replace"><![CDATA[
				$_['entry_meta_description'] = 'Mô tả từ khóa:';
			]]></search>
			<add><![CDATA[
				$_['entry_meta_description'] = 'Giới thiệu sản phẩm';
			]]></add>
		</operation>
	</file>
	<file name="admin/controller/common/menu.php">
		<operation>
			<search position="after"><![CDATA[
				$data['text_help'] = $this->language->get('text_help');
			]]></search>
			<add><![CDATA[
				$data['text_home_intro'] = $this->language->get('text_home_intro');
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[
				$data['geo_zone'] = $this->url->link('localisation/geo_zone', 'token=' . $this->session->data['token'], 'SSL');
			]]></search>
			<add><![CDATA[
				$data['home_intro'] = $this->url->link('plugin/introduce', 'token=' . $this->session->data['token'], 'SSL');
			]]></add>
		</operation>
	</file>
	<file name="admin/language/english/common/menu.php">
		<operation>
			<search position="after"><![CDATA[
				$_['text_geo_zone']                    = 'Geo Zones';
			]]></search>
			<add><![CDATA[
				$_['text_home_intro']                  = 'Home Introduce';
			]]></add>
		</operation>
	</file>
	<file name="admin/language/vietnamese/common/menu.php">
		<operation>
			<search position="after"><![CDATA[
				$_['text_geo_zone']                    = 'Vùng Geo';
			]]></search>
			<add><![CDATA[
				$_['text_home_intro']                  = 'Giới thiệu ở trang chủ';
			]]></add>
		</operation>
	</file>
	<file name="admin/view/template/common/menu.tpl">
		<operation>
			<search position="after"><![CDATA[
				<li><a href="<?php echo $contact; ?>"><?php echo $text_contact; ?></a></li>
			]]></search>
			<add><![CDATA[
				<li><a href="<?php echo $home_intro; ?>"><?php echo $text_home_intro; ?></a></li>
			]]></add>
		</operation>
	</file>
	<file name="admin/controller/marketing/affiliate.php">
		<operation>
			<search position="after"><![CDATA[
				$data['column_balance'] = $this->language->get('column_balance');
			]]></search>
			<add><![CDATA[
				$data['column_total'] = $this->language->get('column_total');
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[
				'unlock'       => $unlock,
			]]></search>
			<add><![CDATA[
				'total'		   => $this->currency->format($result['total'], $this->config->get('config_currency')),
			]]></add>
		</operation>
	</file>
	<file name="admin/language/english/marketing/affiliate.php">
		<operation>
			<search position="after"><![CDATA[
				$_['column_balance']            = 'Balance';
			]]></search>
			<add><![CDATA[
				$_['column_total']            = 'Total';
			]]></add>
		</operation>
	</file>
	<file name="admin/language/vietnamese/marketing/affiliate.php">
		<operation>
			<search position="after"><![CDATA[
				$_['column_balance']            = 'Balance';
			]]></search>
			<add><![CDATA[
				$_['column_total']            = 'Total';
			]]></add>
		</operation>
	</file>
	<file name="admin/model/marketing/affiliate.php">
		<operation>
			<search position="replace"><![CDATA[
				$sql = "SELECT *, CONCAT(a.firstname, ' ', a.lastname) AS name, (SELECT SUM(at.amount) FROM " . DB_PREFIX . "affiliate_transaction at WHERE at.affiliate_id = a.affiliate_id GROUP BY at.affiliate_id) AS balance FROM " . DB_PREFIX . "affiliate a";
			]]></search>
			<add><![CDATA[
				$sql = "SELECT *, CONCAT(a.firstname, ' ', a.lastname) AS name, (SELECT SUM(at.amount) FROM " . DB_PREFIX . "affiliate_transaction at WHERE at.affiliate_id = a.affiliate_id GROUP BY at.affiliate_id) AS balance, (SELECT SUM(od.total) FROM " . DB_PREFIX . "`order` od WHERE od.affiliate_id = a.affiliate_id GROUP BY od.affiliate_id) AS total FROM " . DB_PREFIX . "affiliate a";
			]]></add>
		</operation>
	</file>
	<file name="admin/view/template/marketing/affiliate_list.tpl">
		<operation>
			<search position="after"><![CDATA[
				<td class="text-right"><?php echo $column_balance; ?></td>
			]]></search>
			<add><![CDATA[
				<td class="text-right"><?php echo $column_total; ?></td>
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[
				<td class="text-right"><?php echo $affiliate['balance']; ?></td>
			]]></search>
			<add><![CDATA[
				<td class="text-right"><?php echo $affiliate['total']; ?></td>
			]]></add>
		</operation>
	</file>
</modification>
