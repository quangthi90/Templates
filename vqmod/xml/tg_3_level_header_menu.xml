<modification>
		<id>TG 3 Level Header Menu</id>
		<version>1.0</version>
        <vqmver>2.2.1</vqmver>
        <author>themeglobal.com</author>
		
		<file name="catalog/controller/common/header.php">
		<operation>
				<search position="before"><![CDATA[
				$this->load->model('catalog/product');
				]]></search>
			
				<add><![CDATA[
				if (isset($this->request->get['path'])) {
				$parts = explode('_', (string)$this->request->get['path']);
				} else {
					$parts = array();
				}
		
				if (isset($parts[0])) {
					$this->data['category_id'] = $parts[0];
				} else {
					$this->data['category_id'] = 0;
				}
		
				if (isset($parts[1])) {
					$this->data['child_id'] = $parts[1];
				} else {
					$this->data['child_id'] = 0;
				}

				if (isset($parts[2])) {
					$this->data['subcategory_id'] = $parts[2];
				} else {
					$this->data['subcategory_id'] = 0;
				}
				$this->load->model('tool/image');
				$this->data['noimage1'] = $this->model_tool_image->resize('catalog/view/theme/metro/image/noimage.jpg', 805, 162);
				$this->data['noimage2'] = $this->model_tool_image->resize('catalog/view/theme/metro/image/noimage.jpg', 150, 150);
				]]></add>
		</operation>	   
    
		<operation>
				<search position="replace" offset="35"><![CDATA[
				$categories = $this->model_catalog_category->getCategories(0);
				]]></search>
				
				<add><![CDATA[
				$categories = $this->model_catalog_category->getCategories(0);
				foreach ($categories as $category) {
				//if ($category['top']) {              
				$children_data = array();
				$subcategory_data = array();
				$children = $this->model_catalog_category->getCategories($category['category_id']);
             
				foreach ($children as $child) {  
					$data = array(
						'filter_category_id'  => $child['category_id'],
						'filter_sub_category' => true	
					);		
						
					if ($this->config->get('config_product_count')) {
						$product_total = $this->model_catalog_product->getTotalProducts($data);
						
						$child['name'] .= ' (' . $product_total . ')';
					}                      
                $subcategory_data = array();
                $subcategory = $this->model_catalog_category->getCategories($child['category_id']);
                if($subcategory) {
                   foreach ($subcategory as $sisterMember) {
                      $subcategory_data[] = array(
                         'category_id' =>$sisterMember['category_id'],
                         'name'        => $sisterMember['name'],
                         'href'        => $this->url->link('product/category', 'path=' . $category['category_id'] . '_' . $child['category_id']. '_' . $sisterMember['category_id'])   
                      );                     
                                 
                   }  
                   $children_data[] = array(
                         'category_id' => $child['category_id'],
                         'sub_category_id'   => $subcategory_data,
                         'name'        => $child['name'],
                         'href'        => $this->url->link('product/category', 'path=' . $category['category_id'] . '_' . $child['category_id'])   
                      );   
                } else {                     
                   $children_data[] = array(
                         'category_id' => $child['category_id'],
                         'sub_category_id'   =>'',
                         'name'        => $child['name'],
                         'href'        => $this->url->link('product/category', 'path=' . $category['category_id'] . '_' . $child['category_id'])   
                      );   
					}
				}         

				$this->data['categories'][] = array(
                'category_id' => $category['category_id'],
                'name'        => $category['name'],
                'children'    => $children_data,
                'sister'      => $subcategory_data,
                'href'        => $this->url->link('product/category', 'path=' . $category['category_id'])
				);             
				}
			
				$this->data['text_home'] = $this->language->get('text_home');
				$this->data['text_shopping_cart'] = $this->language->get('text_shopping_cart');
    			$this->data['text_search'] = $this->language->get('text_search');
				$this->data['text_account'] = $this->language->get('text_account');
    			$this->data['text_checkout'] = $this->language->get('text_checkout');
				$this->data['home'] = $this->url->link('common/home');
				$this->data['wishlist'] = $this->url->link('account/wishlist', '', 'SSL');
				$this->data['logged'] = $this->customer->isLogged();
				$this->data['account'] = $this->url->link('account/account', '', 'SSL');
				$this->data['shopping_cart'] = $this->url->link('checkout/cart');
				$this->data['checkout'] = $this->url->link('checkout/checkout', '', 'SSL');
				$this->data['text_welcome'] = $this->language->get('text_welcome');
				$this->data['text_logged'] = $this->language->get('text_logged');
				$this->data['text_loggout'] = $this->language->get('text_loggout');
				$this->data['loggout'] = $this->url->link('account/logout', '', 'SSL');
				$this->data['login'] = $this->url->link('account/login', '', 'SSL');
				$this->data['text_beauty'] = $this->language->get('text_beauty');
				$this->data['text_getthelook'] = $this->language->get('text_getthelook');
				$this->data['text_asseenin'] = $this->language->get('text_asseenin');
				$this->data['text_ournyc'] = $this->language->get('text_ournyc');
				$this->data['text_storelocator'] = $this->language->get('text_storelocator');
				$this->data['text_help'] = $this->language->get('text_help');
				$this->data['text_signin'] = $this->language->get('text_signin');
				$this->data['text_searchnow'] = $this->language->get('text_searchnow');
				$this->data['text_bestseller'] = $this->language->get('text_bestseller');
    			$this->data['text_news'] = $this->language->get('text_news');
    			$this->data['link_bestseller'] = $this->url->link('product/bestseller', '', 'SSL');
    			$this->data['link_news'] = $this->url->link('news/category&npath=1', '', 'SSL');
    			$this->data['storelocator'] = $this->url->link('information/information&information_id=12', '', 'SSL');
				$this->data['help'] = $this->url->link('information/contact', '', 'SSL');     
				]]></add>
	</operation>
</file>			
</modification>
